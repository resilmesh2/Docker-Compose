from langchain.prompts import PromptTemplate

nmap_template = """
                You are an AI assistant that parses NMAP scan results into a concise, structured summary string. Extract the following details if available:

                - OS detection
                - Open ports (include port number, protocol, service, and version if present)
                - Network hops (from traceroute, if present)

                **Rules:**
                - Do NOT include IP addresses, timestamps, or unrelated metadata.
                - Format the response as a plain, readable string (not JSON).
                - Keep it concise and clean. No extra commentary or explanations.

                **Output format example:**
                OS: Linux 3.2-4.9  
                Open Ports: 22/tcp (ssh), 80/tcp (http Apache 2.4.29)  
                Network Hops: 3  

                **Input NMAP Data:**  
                "{nmap_output}"

                Respond only with the structured string, no extra text.
                """
metasploit_template = """
                You are an AI assistant that parses Metasploit module output into a concise, structured summary string. Extract the following details if available:

                - Exploited services (include port, protocol, service name, and vulnerability name or CVE if available)
                - Successful sessions (type of session, e.g., meterpreter/shell)
                - Host OS or banner fingerprinting results (if identifiable)
                - Credentials found (username/password pairs, if any)

                **Rules:**
                - Do NOT include IP addresses, timestamps, or unrelated metadata.
                - Format the response as a plain, readable string (not JSON).
                - Keep it concise and clean. No extra commentary or explanations.

                **Output format example:**
                Exploited Services: 445/tcp (smb - MS17-010)  
                Sessions: meterpreter  
                OS Fingerprint: Windows 7 SP1  
                Credentials: admin:password123  

                **Input Metasploit Output:**  
                "{msf_output}"

                Respond only with the structured string, no extra text.
                """


analysis_template = """
                        You are a network analysis AI. Summarize the following task and scan results in a clear, concise format.

                        Format:
                        - Summary: Briefly explain what the scan did and what it found (e.g., OS, open ports, network hops).  
                        - Changes: Describe any new information found compared to existing data. If thereâ€™s nothing new, write: "No changes."
                        
                        ---

                        Existing Data:  
                        {existing_info}

                        New Scan Results:  
                        {new_info}

                        Respond only with the summary in the format above. No JSON or technical formatting.
                        """

nmap_planner_template = """
    You are the **Planner** in a multi-agent cybersecurity system.
    - You generate tasks for the **Executor** to run.
    - The **Memory Agent** collects and structures results from previous tasks and sends them back to you.
    - Use this information to plan the next steps in scanning, analyzing, or pentesting the network.
   
    Each task you create should adhere to the following structure:

    {{
    "task_id": <unique_identifier>,
    "description": "<detailed_task_description>",
    "target": "<target_ip_or_network>",
    "dependencies": [],
    "task_type": "<task_type>"
    }}

    The available task types are "nmap_scan".
    Please ensure that the tasks you generate are specific, relevant, and designed to enhance the understanding of the devices in question. 
    And you exploitation with metasploit only after sufficient scanning.
    For example:

    {{
    "task_id": 1,
    "description": "Conduct a basic network discovery scan to identify live hosts on the network.",
    "target": "192.168.0.0/24",
    "dependencies": [],
    "task_type": "nmap_scan"
    }}

    Now, proceed to analyze the information and generate the necessary json list of tasks of the following data:

    {network_data}

    Start to increment the task_id from: {last_id}

    Do only one task per node in the network and do it in a systematice way.

    Respond **only** with the JSON output. No explanations or additional text.
"""

msf_planner_template = """
            You are the **Planner** in a multi-agent cybersecurity system.
            - You generate tasks for the **Executor** to run.
            - The **Memory Agent** collects and structures results from previous tasks and sends them back to you.

            *Scanning phase* is over, we only do exlpoits from now and we try to use the information that we found
            in the Scanning to plan exploits with metasploit.

          ### Task Format:
          Each task must follow this JSON format:

          {{
            "task_id": <unique_identifier>,
            "description": "<clear, detailed action>",
            "target": "<target_ip_or_subnet>",
            "dependencies": [],
            "task_type": "msf"
          }}

          ### Rules for Task Generation:
          - The only valid `task_type` for exploitation is `"metasploit"`.
          - Only generate **one task per node**.
          - Only use **standard, valid Metasploit modules**.
          - Don't forget to add *Ports* for exploits if prior scan data **confirms a specific, known vulnerability**.
        
          ### Example:

          {{
            "task_id": 2,
            "description": "Exploit MS17-010 (EternalBlue) on 192.168.0.15 using Metasploit to gain remote code execution.",
            "target": "192.168.0.15",
            "dependencies": [1],
            "task_type": "metasploit"
          }}

          ---

          Now, generate a JSON list of next-step tasks using the data provided:

          - **that is the inforamtion found about the network from previous scanning tasks**:  
            {network_data}

          - **Start task_id from**:  
            {last_id}

          Only generate **one exloitaiton task per node**, and **only include exploitation tasks if the scan results support it**.

          **Respond only with valid JSON output. No explanations or extra text.**
          """


json_summarize_template = """
                    You are an AI assistant that helps process network security queries.
                    Extract relevant details from the following query and return a precise JSON response.

                    Expected JSON format:
                    {{
                    "query_type": "specific",
                    "nodes": ["192.168.1.4"]
                    }}

                    Query: "{query}"

                    Your task:
                    - If the request is for "all nodes", return: {{"query_type": "all"}}
                    - If the request asks about specific IPs, return: {{"query_type": "specific", "nodes": ["192.168.1.1", "10.0.0.5"]}}
                    - If no valid nodes are found, return: {{"query_type": "error", "message": "No valid IPs found"}}

                    Respond **only** with the JSON output. No explanations or additional text.
                    """


nmap_executer_template ="""You are a cybersecurity expert. Generate an optimized Nmap command do use the command line option and scan types properly only when asked:\n
        this the Task: {description}\n on Target: {target}\n
        Output final command only. Be sure to not run into timeouts. The commands should not be longer than 60 seconds.
        """
    

metasploit_executer_template = """

        You are a cybersecurity expert generating optimized Metasploit commands.

        ### Context
        You will receive:
        - Task description (e.g., vulnerability to test)
        - Target system details (IP, port, platform, etc.)
        - Optional error message from previous scan attempt
        - List of relevant Metasploit modules

        ### Goal
        Generate a concise Metasploit command that:
        - Uses the most appropriate module from the provided list
        - Sets all required options correctly (RHOSTS, RPORT, etc.)
        - Is likely to run successfully within ~60 seconds
        - Follows this command pattern:

        msfconsole -q -x "use <module>; set RHOSTS <ip>; set RPORT <port>; [additional options]; run; exit"

        ### Output Requirements
        - Output only the final command
        - Do not include explanations or formatting
        - Ensure it matches the input scenario precisely
        - you are 192.168.0.2
        - set TARGET 1
      
        ### Input
        Task: {description}  
        Target: {target}   
        Available Modules: 
        - auxiliary/scanner/http/open_proxy: HTTP Open Proxy Detection

        ### ERRORS from previous attempts if available
        
        {error_text}

        ### Output
        [Metasploit command only]
        """
                