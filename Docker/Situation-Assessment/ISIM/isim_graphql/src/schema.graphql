type Application {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  name: String!
  devices: [Device!]! @relationship(type: "RUNNING_ON", direction: OUT)
}

type Component {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  name: String!
  missions: [Mission!]! @relationship(type:  "SUPPORTS", direction: OUT)
  hosts: [Host!]! @relationship(type:  "PROVIDED_BY", direction: OUT)
  from_mission_dependencies: [MissionDependency!]! @relationship(type: "FROM", direction: IN)
  to_mission_dependencies: [MissionDependency!]! @relationship(type: "TO", direction: IN)
}

type Contact {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  name: String!
  subnets: [Subnet!]! @relationship(type: "HAS", direction: IN)
}

type CVSSv2 {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )

  vector_string: String
  access_vector: String
  access_complexity: String
  authentication: String
  confidentiality_impact: String
  integrity_impact: String
  availability_impact: String
  base_score: Float
  base_severity: String
  exploitability_score: Float
  impact_score: Float
  ac_insuf_info: Boolean
  obtain_all_privilege: Boolean
  obtain_user_privilege: Boolean
  obtain_other_privilege: Boolean
  user_interaction_required: Boolean
}

type CVSSv30 {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )

  vector_string: String
  attack_vector: String
  attack_complexity: String
  privileges_required: String
  user_interaction: String
  scope: String
  confidentiality_impact: String
  integrity_impact: String
  availability_impact: String
  base_score: Float
  base_severity: String
  exploitability_score: Float
  impact_score: Float
}

type CVSSv31 {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )

  vector_string: String
  attack_vector: String
  attack_complexity: String
  privileges_required: String
  user_interaction: String
  scope: String
  confidentiality_impact: String
  integrity_impact: String
  availability_impact: String
  base_score: Float
  base_severity: String
  exploitability_score: Float
  impact_score: Float
}

type CVSSv40 {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )

  vector_string: String
  attack_vector: String
  attack_complexity: String
  attack_requirements: String
  privileges_required: String
  user_interaction: String
  vulnerable_system_confidentiality: String
  vulnerable_system_integrity: String
  vulnerable_system_availability: String
  subsequent_system_confidentiality: String
  subsequent_system_integrity: String
  subsequent_system_availability: String
  base_score: Float
  base_severity: String
  exploit_maturity: String
}

type CVE {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )

  cve_id: String!
  description: String!
  cwe: [String]
  cpe_type: [String]!
  ref_tags: [String]
  published: String!
  last_modified: String!
  result_impacts: [String]


  vulnerability: Vulnerability! @relationship(type:  "REFERS_TO", direction: IN)
  cvss_v2: CVSSv2 @relationship(type: "HAS_CVSS_v2", direction: OUT)
  cvss_v30: CVSSv30 @relationship(type: "HAS_CVSS_v30", direction: OUT)
  cvss_v31: CVSSv31 @relationship(type: "HAS_CVSS_v31", direction: OUT)
  cvss_v40: CVSSv40 @relationship(type: "HAS_CVSS_v40", direction: OUT)
}

type Device {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  name: String
  state: String
  power: String
  hardware_version: HardwareVersion @relationship(type: "HAS", direction: OUT)
  applications: [Application!]! @relationship(type: "RUNNING_ON", direction: IN)
}

type DomainName {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  domain_name: String!
  tag: [String]!
  ips: [IP!]! @relationship(type:  "RESOLVES_TO", direction: IN)
}

type HardwareVersion {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  manufacturer: String!
  model: String!
  devices: [Device!]! @relationship(type: "HAS", direction: IN)
}

type Host {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  hostname: String
  node: NodeObject @relationship(type:  "IS_A", direction: IN)
  software_versions: [SoftwareVersion!]! @relationship(type:  "ON", direction: IN)
  components: [Component!]! @relationship(type:  "PROVIDED_BY", direction: IN)
  network_services: [NetworkService!]! @relationship(type: "ON", direction: IN)
}

type IP {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  address: String!
  version: Int
  tag: [String]
  domain_names: [DomainName!]! @relationship(type:  "RESOLVES_TO", properties: "ResolvesTo", direction: OUT)
  uris: [URI!]! @relationship(type: "IDENTIFIES", direction: OUT)
  nodes: [NodeObject!]! @relationship(type:  "HAS_ASSIGNED", properties: "HasAssigned", direction: IN)
  subnets: [Subnet!]! @relationship(type:  "PART_OF", direction: OUT)
}

type NetworkService {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  protocol: String
  port: Int
  tag: [String]
  service: String
  hosts: [Host!]! @relationship(type: "ON", properties: "NetworkServiceOn", direction: OUT)
  software_versions: [SoftwareVersion!]! @relationship(type: "PROVIDES", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
}

type NodeObject @node(labels: "Node") {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  degree_centrality: Float
  pagerank_centrality: Float
  topology_betweenness: Float
  topology_degree: Float
  topology_degree_norm: Float
  topology_betweenness_norm: Float
  mission_criticality: Float
  final_criticality: Float
  ips: [IP!]! @relationship(type:  "HAS_ASSIGNED", direction: OUT, properties: "HasAssigned")
  host: Host @relationship(type:  "IS_A", direction: OUT)
  is_dependent_on_nodes: [NodeObject!]! @relationship(type:  "IS_DEPENDENT_ON", direction: OUT)
  is_connected_to_nodes: [NodeObject!]! @relationship(type:  "IS_CONNECTED_TO", direction: OUT)
}

type OrganizationUnit {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  name: String!
  subnets: [Subnet!]! @relationship(type:  "PART_OF", direction: IN)
  physical_environments: [PhysicalEnvironment!]! @relationship(type: "TENANTS", direction: OUT),
  parent_org_unit: [OrganizationUnit!]! @relationship(type: "PART_OF", direction: OUT)
  contacts: [Contact!]! @relationship(type: "HAS", direction: OUT)
}

type PhysicalEnvironment {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  location: String!
  org_units: [OrganizationUnit!]! @relationship(type: "TENANTS", direction: IN)
}

type SoftwareVersion {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  tag: [String]
  version: String!
  hosts: [Host!]! @relationship(type: "ON", properties: "SoftwareOn", direction: OUT)
  network_services: [NetworkService!]! @relationship(type: "PROVIDES", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  vulnerabilities: [Vulnerability!]! @relationship(type: "IN", direction: IN)
}

type Subnet {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  note: String
  range: String!
  org_units: [OrganizationUnit!]! @relationship(type:  "PART_OF", direction: OUT)
  parent_subnet: [Subnet!]! @relationship(type:  "PART_OF", direction: OUT)
  contacts: [Contact!]! @relationship(type: "HAS", direction: OUT)
}

type Mission {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  criticality: Int
  confidentiality_requirement: Int
  integrity_requirement: Int
  availability_requirement: Int
  description: String!
  name: String!
  structure: String!
  components: [Component!]! @relationship(type:  "SUPPORTS", direction: IN)
}

type MissionDependency {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  from_components: [Component!]! @relationship(type: "FROM", direction: OUT)
  to_components: [Component!]! @relationship(type: "TO", direction: OUT)
}

type URI {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  identifier: String!
  ips: [IP!]! @relationship(type: "IDENTIFIES", direction: IN)
}

type Vulnerability {
  _id: ID! @cypher(
    statement: """
        MATCH (this)
        RETURN toString(ID(this)) AS _id
    """,
    columnName: "_id"
  )
  description: String!
  software_versions: [SoftwareVersion!]! @relationship(type:  "IN", direction: OUT)
  cve: CVE @relationship(type:  "REFERS_TO", direction: OUT)
}

type ResolvesTo @relationshipProperties {
  start: String
  end: String
}

type SoftwareOn @relationshipProperties {
  end: String
  start: String
  tag: [String]
}

type NetworkServiceOn @relationshipProperties {
  end: String
  start: String
  tag: [String]
}

type HasAssigned @relationshipProperties {
    start: String,
    end: String
}

type Mutation {
    linkSubnetToParent(subnetRange: String!, parentSubnetRange: String!): Subnet
      @cypher(
        statement: """
          MATCH (s:Subnet {range: $subnetRange}), (p:Subnet {range: $parentSubnetRange})
          CREATE (s)-[:PART_OF]->(p)
          RETURN s
        """,
        columnName: "s"
    )

    linkSubnetToOrgUnit(subnetRange: String!, orgUnitName: String!): Subnet
      @cypher(
        statement: """
          MATCH (s:Subnet {range: $subnetRange}), (o:OrganizationUnit {name: $orgUnitName})
          CREATE (s)-[:PART_OF]->(o)
          RETURN s
        """,
        columnName: "s"
    )

    mergeSubnetWithContacts(subnetRange: String!, contactNames: [String!]!): Subnet
      @cypher(
        statement: """
          MATCH (s:Subnet {range: $subnetRange})
          UNWIND $contactNames AS contact_name
          MERGE (c:Contact {name: contact_name})
          MERGE (s)-[:HAS]->(c)
          RETURN s
        """,
        columnName: "s"
    )

    unlinkSubnetFromParent(subnetRange: String!, parentRange: String!): Subnet
      @cypher(
        statement: """
          MATCH (s:Subnet {range: $subnetRange})-[r:PART_OF]->(oldParent:Subnet)
          DELETE r
          RETURN s
        """,
        columnName: "s"
    )

    unlinkSubnetFromOrgUnit(subnetRange: String!, orgUnitName: String!): Subnet
      @cypher(
        statement: """
          MATCH (s:Subnet {range: $subnetRange})-[r:PART_OF]->(oldOrgUnit:OrganizationUnit)
          DELETE r
          RETURN s
        """,
        columnName: "s"
    )

    unlinkSubnetFromContacts(subnetRange: String!, contactNames: [String!]!): Subnet
      @cypher(
        statement: """
          MATCH (s:Subnet {range: $subnetRange})
          UNWIND $contactNames AS contact_name
          MATCH (c:Contact {name: contact_name})
          MATCH (s)-[r:HAS]->(c)
          DELETE r
          RETURN s
        """,
        columnName: "s"
    )

    linkOrgUnitToParentOrg(orgUnitName: String!, parentOrgUnitName: String!): OrganizationUnit
      @cypher(
        statement: """
          MATCH (org:OrganizationUnit {name: $orgUnitName}), (parent:OrganizationUnit {name: $parentOrgUnitName})
          CREATE (org)-[:PART_OF]->(parent)
          RETURN org
        """,
        columnName: "org"
    )

    mergeOrgUnitWithContacts(orgUnitName: String!, contactNames: [String!]!): OrganizationUnit
      @cypher(
        statement: """
          MATCH (org:OrganizationUnit {name: $orgUnitName})
          UNWIND $contactNames AS contact_name
          MERGE (c:Contact {name: contact_name})
          MERGE (org)-[:HAS]->(c)
          RETURN org
        """,
        columnName: "org"
    )

    unlinkOrgUnitFromParents(orgUnitName: String!): OrganizationUnit
      @cypher(
        statement: """
          MATCH (org:OrganizationUnit {name: $orgUnitName})-[r:PART_OF]->(oldParent:OrganizationUnit)
          DELETE r
          RETURN org
        """,
        columnName: "org"
    )

    unlinkOrgUnitFromContacts(orgUnitName: String!, contactNames: [String!]!): OrganizationUnit
      @cypher(
        statement: """
          MATCH (org:OrganizationUnit {name: $orgUnitName})
          UNWIND $contactNames AS contact_name
          MATCH (c:Contact {name: contact_name})
          MATCH (org)-[r:HAS]->(c)
          DELETE r
          RETURN org
        """,
        columnName: "org"
    )

    updateIPTag(address: String!, tag: [String]!): IP
      @cypher(
        statement: "MATCH (ip:IP {address: $address}) SET ip.tag = $tag RETURN ip",
        columnName: "ip"
      )
}